# Thesis Generation Prompt

You are generating a **Thesis** document - the final synthesis of a Pathfinder research session.

---

## Input Files

Read the following files from the session directory:

1. `cognigraph.json` - The knowledge graph with observations, hypotheses, and edges
2. `state.json` - Session metadata (question, iterations, status)

---

## Generation Logic

### Step 1: Select Core Hypotheses

Filter hypotheses that qualify as "core findings":

```
QUALIFIED = hypothesis WHERE:
  status == "verified"
  OR (status == "tested" AND strength >= 0.55)
```

Sort by `strength` descending.

### Step 2: Collect Supporting Observations

For each qualified hypothesis:
- Find all edges where `edge.type == "SUPPORTS"` and `edge.to == hypothesis.id`
- Collect the source observations
- Include their summaries and source URLs

### Step 3: Categorize by Type

- **Type A (Evidence-based):** Standard findings from external sources
- **Type B (Agent Insight):** Mark separately as "Agent Insight" in output

### Step 4: Identify Rejected and Unresolved

- **Rejected:** `status == "refuted"`
- **Unresolved:** `status == "unvisited"` OR `status == "tested" AND strength < 0.55`

---

## Output Format

Generate the thesis in the following Markdown format:

```markdown
# Thesis: {One-sentence answer to the research question}

## Research Overview
- **Question:** {original_question from state.json}
- **Duration:** {iterations} iterations
- **Observations collected:** {count of nodes where type == "observation"}
- **Hypotheses generated:** {count of nodes where type == "hypothesis"} (Type A: {count where source_type == "A"}, Type B: {count where source_type == "B"})
- **Final status:** {status from state.json}

## Core Conclusion

{1-2 paragraph synthesis based on the strongest verified hypotheses. This should directly answer the original research question.}

## Key Findings

{For each qualified hypothesis, ordered by strength:}

### Finding {N}: {Short title} (Confidence: {strength})

**Hypothesis:** {statement}

**Type:** {Type A: Evidence-based | Type B: Agent Insight}

**Supporting Evidence:**
{For each supporting observation:}
- `{obs_id}`: {summary} ([source]({url}))

**Reasoning Method:** {reasoning_tool if present}

---

## Qualified Conclusions

{List hypotheses that are verified but with caveats or conditions}

| Hypothesis | Condition | Confidence |
|------------|-----------|------------|
| {statement} | {any noted limitations} | {strength} |

## Rejected Hypotheses

{List refuted hypotheses with reasons}

| Hypothesis | Rejection Reason | Contradicting Evidence |
|------------|------------------|------------------------|
| {statement} | {reason from refutation edge or status change} | {obs_ids that contradict} |

## Unresolved Areas

### Untested Hypotheses
{List hypotheses with status == "unvisited"}
- {statement} (Generated at iteration {iteration})

### Potential Future Directions
{Infer from the graph structure - areas with few observations or untested hypotheses}
- {direction 1}
- {direction 2}

## Research Timeline

| Iteration | Key Events |
|-----------|------------|
| {N} | {Major hypothesis verified/refuted, key observation found} |

## Sources (by Authority)

{Group sources by authority level, highest first}

### Academic Sources
{observations where authority >= 0.8}
1. [{title}]({url}) - {brief description}

### Official Documentation
{observations where 0.6 <= authority < 0.8}
1. [{title}]({url}) - {brief description}

### Community Sources
{observations where authority < 0.6}
1. [{title}]({url}) - {brief description}

---

*Generated by Pathfinder Research*
*Session: {session_id}*
*Date: {current_date}*
```

---

## Special Cases

### No Verified Hypotheses

If no hypotheses meet the qualification criteria:

```markdown
# Thesis: Inconclusive

## Research Overview
{same as above}

## Status: Inconclusive

This research session did not produce verified conclusions. Possible reasons:
- Insufficient iterations ({iterations} completed)
- Conflicting evidence in the domain
- Question may require decomposition

## Strongest Candidates
{List top 3 hypotheses by strength, even if < 0.55}

## Recommended Next Steps
1. Resume research with `pathfinder-research --resume`
2. Refine the research question
3. Focus on specific sub-questions
```

### SATURATED Status

If `state.json` shows `status == "SATURATED"`:

Add a note in the overview:
```markdown
> **Note:** Research reached saturation - no new hypotheses generated in recent iterations.
> This may indicate comprehensive coverage or a need for new research angles.
```

---

## Formatting Guidelines

1. **Confidence scores:** Display as decimal (0.85) not percentage
2. **Observation IDs:** Use backticks for IDs (`obs_1`)
3. **URLs:** Always hyperlink, never bare URLs
4. **Type B hypotheses:** Always mark clearly as "Agent Insight"
5. **Empty sections:** Omit sections with no content (e.g., no rejected hypotheses)
6. **Korean/English:** Match the language of the original question

---

## Example Partial Output

```markdown
# Thesis: Claude Code의 MCP 도구 통합은 외부 API 연동에 가장 효과적이다

## Research Overview
- **Question:** Claude Code에서 MCP 도구를 효과적으로 활용하는 방법은?
- **Duration:** 12 iterations
- **Observations collected:** 23개
- **Hypotheses generated:** 8개 (Type A: 6, Type B: 2)
- **Final status:** SATURATED

## Core Conclusion

MCP(Model Context Protocol) 도구는 Claude Code의 기본 도구로 처리하기 어려운 외부 시스템 통합에 가장 큰 가치를 제공한다. 특히 데이터베이스 직접 접근, 외부 API 호출, 커스텀 인증이 필요한 작업에서 효과적이다.

## Key Findings

### Finding 1: 외부 API 통합 효율성 (Confidence: 0.89)

**Hypothesis:** MCP 도구는 REST API 통합 시 기본 Bash curl보다 안정적이다

**Type:** Type A: Evidence-based

**Supporting Evidence:**
- `obs_3`: MCP 서버가 인증 토큰 관리를 자동화함 ([Anthropic Docs](https://docs.anthropic.com/mcp))
- `obs_7`: 재시도 로직이 MCP 레벨에서 처리됨 ([GitHub Discussion](https://github.com/anthropics/mcp/discussions/42))

**Reasoning Method:** Comparative Analysis
```

---

## Validation Checklist

Before outputting, verify:

- [ ] All qualified hypotheses included
- [ ] Strength values are from cognigraph.json, not invented
- [ ] All source URLs are real (from observations)
- [ ] Type A/B distinction is accurate
- [ ] No hallucinated observations or hypotheses
- [ ] Language matches original question
